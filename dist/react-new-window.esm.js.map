{"version":3,"file":"react-new-window.esm.js","sources":["../src/NewWindow.js"],"sourcesContent":["'use strict'\n\n/**\n * Component dependencies.\n * @private\n */\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\n/**\n * The NewWindow class object.\n * @public\n */\n\nclass NewWindow extends React.PureComponent {\n\n  /**\n   * NewWindow default props.\n   */\n  static defaultProps = {\n    url: '',\n    name: '',\n    title: '',\n    features: {},\n    onBlock: null,\n    onUnload: null,\n    center: 'parent'\n  }\n\n  /**\n   * The NewWindow function constructor.\n   * @param {Object} props\n   */\n  constructor(props) {\n    super(props)\n    this.container = document.createElement('div')\n    this.window = null\n  }\n\n  /**\n   * Render the NewWindow component.\n   */\n  render() {\n    return ReactDOM.createPortal(this.props.children, this.container)\n  }\n\n  /**\n   * Create the new window when NewWindow component mount.\n   */\n  componentDidMount() {\n    const { url, title, name, features, onBlock, onUnload, center } = this.props\n\n    // Prepare position of new window to appear center against the 'parent' window or 'screen'.\n    if (typeof center === 'string' && (features.left === undefined || features.top === undefined)) {\n      console.warn('left and top window features must be present when a center prop is provided')\n    } else if (center === 'parent') {\n      features.left = window.top.outerHeight / 2 + window.top.screenY - ( h / 2)\n      features.top = window.top.outerWidth / 2 + window.top.screenX - ( w / 2)\n    } else if (center === 'screen') {\n      const screenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;\n      const screenTop = window.screenTop !== undefined ? window.screenTop : screen.top;\n\n      const width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;\n      const height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;\n\n      features.left = ((width / 2) - (w / 2)) + screenLeft;\n      features.top = ((height / 2) - (h / 2)) + screenTop;\n    }\n\n    // Open a new window.\n    this.window = window.open(url, name, toWindowFeatures(features))\n\n    // Check if the new window was succesfully opened.\n    if (this.window) {\n      this.window.document.title = title\n      this.window.document.body.appendChild(this.container)\n\n      copyStyles(document, this.window.document)\n\n      this.window.addEventListener('beforeunload', () => {\n        if (typeof onUnload === 'function') {\n          onUnload.call(null)\n        }\n      })\n    } else {\n\n      // Handle error on opening of new window.\n      if (typeof onBlock === 'function') {\n        onBlock.call(null)\n      } else {\n        console.warn('A new window could not be opened. Maybe it was blocked.')\n      }\n    }\n  }\n\n  /**\n   * Close the opened window (if any) when NewWindow will unmount.\n   */\n  componentWillUnmount() {\n    if (this.window) {\n      this.window.close()\n    }\n  }\n}\n\n/**\n * Utility functions.\n * @private\n */\n\n/**\n * Copy styles from a source document to a target.\n * @param {Object} source\n * @param {Object} target\n * @private\n */\n\nfunction copyStyles(source, target) {\n  Array.from(source.styleSheets).forEach(styleSheet => {\n\n    // For <style> elements\n    if (styleSheet.cssRules) {\n      const newStyleEl = source.createElement('style')\n\n      // Write the text of each rule into the body of the style element\n      Array.from(styleSheet.cssRules).forEach(cssRule => {\n        newStyleEl.appendChild(source.createTextNode(cssRule.cssText))\n      })\n\n      target.head.appendChild(newStyleEl)\n    }\n\n    // for <link> elements loading CSS from a URL\n    else if (styleSheet.href) {\n      const newLinkEl = source.createElement('link')\n\n      newLinkEl.rel = 'stylesheet'\n      newLinkEl.href = styleSheet.href\n      target.head.appendChild(newLinkEl)\n    }\n  })\n}\n\n/**\n * Convert features props to window features format (name=value,other=value).\n * @param {Object} obj\n * @return {String}\n * @private\n */\n\nfunction toWindowFeatures(obj) {\n  return Object.keys(obj)\n    .reduce((prev, curr) => {\n      prev.push(`${curr}=${obj[curr]}`)\n      return prev\n    }, [])\n    .join(',')\n}\n\n/**\n * Component export.\n * @private\n */\n\nexport default NewWindow\n"],"names":["copyStyles","source","target","from","styleSheets","forEach","styleSheet","cssRules","newStyleEl","createElement","appendChild","createTextNode","cssRule","cssText","head","href","newLinkEl","rel","toWindowFeatures","obj","Object","keys","reduce","prev","curr","push","join","NewWindow","props","container","document","window","ReactDOM","createPortal","this","children","url","title","name","features","onBlock","onUnload","center","undefined","left","top","outerHeight","screenY","h","outerWidth","screenX","w","screenLeft","screen","screenTop","width","innerWidth","documentElement","clientWidth","height","innerHeight","clientHeight","warn","open","body","addEventListener","call","close","React","PureComponent","defaultProps"],"mappings":"AAsHA,SAASA,WAAWC,EAAQC,SACpBC,KAAKF,EAAOG,aAAaC,QAAQ,eAGjCC,EAAWC,SAAU,KACjBC,EAAaP,EAAOQ,cAAc,eAGlCN,KAAKG,EAAWC,UAAUF,QAAQ,cAC3BK,YAAYT,EAAOU,eAAeC,EAAQC,cAGhDC,KAAKJ,YAAYF,QAIrB,GAAIF,EAAWS,KAAM,KAClBC,EAAYf,EAAOQ,cAAc,UAE7BQ,IAAM,eACNF,KAAOT,EAAWS,OACrBD,KAAKJ,YAAYM,MAY9B,SAASE,iBAAiBC,UACjBC,OAAOC,KAAKF,GAChBG,OAAO,SAACC,EAAMC,YACRC,KAAQD,MAAQL,EAAIK,IAClBD,OAERG,KAAK,46BA9IJC,iCAmBQC,iHACJA,aACDC,UAAYC,SAASrB,cAAc,SACnCsB,OAAS,iFAOPC,SAASC,aAAaC,KAAKN,MAAMO,SAAUD,KAAKL,6DAOWK,KAAKN,MAA/DQ,IAAAA,IAAKC,IAAAA,MAAOC,IAAAA,KAAMC,IAAAA,SAAUC,IAAAA,QAASC,IAAAA,SAAUC,IAAAA,UAGjC,iBAAXA,QAA0CC,IAAlBJ,EAASK,WAAuCD,IAAjBJ,EAASM,KAEpE,GAAe,WAAXH,IACAE,KAAOb,OAAOc,IAAIC,YAAc,EAAIf,OAAOc,IAAIE,QAAYC,EAAI,IAC/DH,IAAMd,OAAOc,IAAII,WAAa,EAAIlB,OAAOc,IAAIK,QAAYC,EAAI,OACjE,GAAe,WAAXT,EAAqB,KACxBU,OAAmCT,IAAtBZ,OAAOqB,WAA2BrB,OAAOqB,WAAaC,OAAOT,KAC1EU,OAAiCX,IAArBZ,OAAOuB,UAA0BvB,OAAOuB,UAAYD,OAAOR,IAEvEU,EAAQxB,OAAOyB,WAAazB,OAAOyB,WAAa1B,SAAS2B,gBAAgBC,YAAc5B,SAAS2B,gBAAgBC,YAAcL,OAAOE,MACrII,EAAS5B,OAAO6B,YAAc7B,OAAO6B,YAAc9B,SAAS2B,gBAAgBI,aAAe/B,SAAS2B,gBAAgBI,aAAeR,OAAOM,SAEvIf,KAASW,EAAQ,EAAMJ,EAAI,EAAMC,IACjCP,IAAQc,EAAS,EAAMX,EAAI,EAAMM,gBAZlCQ,KAAK,oFAgBV/B,OAASA,OAAOgC,KAAK3B,EAAKE,EAAMpB,iBAAiBqB,IAGlDL,KAAKH,aACFA,OAAOD,SAASO,MAAQA,OACxBN,OAAOD,SAASkC,KAAKtD,YAAYwB,KAAKL,sBAEhCC,SAAUI,KAAKH,OAAOD,eAE5BC,OAAOkC,iBAAiB,eAAgB,WACnB,mBAAbxB,KACAyB,KAAK,SAMK,mBAAZ1B,IACD0B,KAAK,cAELJ,KAAK,0GASb5B,KAAKH,aACFA,OAAOoC,eAtFMC,MAAMC,eAAxB1C,UAKG2C,kBACA,QACC,SACC,uBAEE,cACC,YACF"}